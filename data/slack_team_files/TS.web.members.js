(function(){"use strict";TS.registerModule("web.members",{lazyload:null,onStart:function(){TS.web.login_sig.add(TS.web.members.onLogin,TS.web.members);if(TS.members&&TS.members.view&&TS.members.view.team_filter_changed_sig){TS.members.view.team_filter_changed_sig.add(TS.web.members.onFilterChanged,TS.members.view.team_filter_changed_sig)}$("#team_tabs").on("click.tabchange",function(e){var $link=$(e.target).closest("a");var tab=$link.data("tab");if($link[0]&&tab){if(TS.boot_data.page_needs_enterprise){if(!TS.model.ui_state)TS.model.ui_state={};TS.model.ui_state.tab_name=tab+"_members";var is_visible;if(_$active_members_list){is_visible=TS.model.ui_state.tab_name=="active_members";_$active_members_list.longListView("setHidden",!is_visible)}if(_$restricted_members_list){is_visible=TS.model.ui_state.tab_name=="restricted_members";_$restricted_members_list.longListView("setHidden",!is_visible)}if(_$deleted_members_list){is_visible=TS.model.ui_state.tab_name=="disabled_members";_$deleted_members_list.longListView("setHidden",!is_visible)}$("#members_div").trigger("resize")}else{$("#members_div").trigger("resize-immediate")}}});if(TS.boot_data.page_needs_enterprise){TS.members.view.bindTeamFilter("#team_filter","#team_list_scroller",true,true,true,true)}else{TS.members.view.bindTeamFilter("#team_filter","#team_list_scroller",true)}if(window.location.hash&&window.location.hash.indexOf("#admins")!==-1){$("#admin_list").show()}},onFilterChanged:function(){if(TS.web.members.lazyload){$("#members_div").trigger("resize-immediate")}},onLogin:function(ok,data){TS.web.members.renderTeam(TS.members.getMembersForUser())},renderTeam:function(members){if(TS.boot_data.page_needs_enterprise){var approx_item_height=116;var approx_divider_height=40;var is_long_list_view=true;var is_lazy=true;$("#members_div").append(TS.templates.builders.buildTeamListHTML(members,is_long_list_view,is_lazy));var make=function($el,items,approx_item_height,approx_divider_height){return $el.longListView({items:items,approx_item_height:approx_item_height,approx_divider_height:approx_divider_height,preserve_dom_order:true,makeElement:function(data){return $(TS.templates.team_list_item({is_long_list_view:true}))},makeDivider:function(data){return $("<div></div>")},renderItem:function($el,item,data){$el.toggleClass("inactive",item.deleted).attr("data-member-id",item.id).data("member-id",item.id).data("item",item);$el.html(TS.templates.team_list_item_member_details({member:item,is_long_list_view:true}));TS.utility.makeSureAllLinksHaveTargets($el)},renderDivider:function($el,item,data){$el.data("item",item).html(TS.templates.team_list_item_divider(item))},calcItemHeight:function($el){var outer_height=$el.outerHeight();if(!outer_height)return approx_item_height;return Math.max(outer_height,approx_item_height)},calcDividerHeight:function($el){var outer_height=$el.outerHeight();if(!outer_height)return approx_divider_height;return outer_height}})};if(!TS.model.ui_state)TS.model.ui_state={};TS.model.ui_state.tab_name="active_members";_$active_members_list=make($("#active_members_list"),[],approx_item_height,approx_divider_height);_$restricted_members_list=make($("#restricted_members_list"),[],approx_item_height,approx_divider_height).longListView("setHidden",true);_$deleted_members_list=make($("#deleted_members_list"),[],approx_item_height,approx_divider_height).longListView("setHidden",true);TS.members.view.filterTeam("","#team_filter","#team_list_scroller",true).then(function(){$("#members_div > .card").remove();$("#members_div").trigger("resize")})}else{$("#members_div").html(TS.templates.builders.buildTeamListHTML(members));if(TS.web.members.lazyload&&TS.web.members.lazyload.detachEvents){TS.web.members.lazyload.detachEvents()}TS.web.members.lazyload=$("#members_div").find(".lazy").lazyload()}$("#members_div").on("click.member_preview_menu",".member_preview_menu_target",function(e){TS.menu.member.startWithMemberPreview(e,null,true)});plastic.initTabs()},buildLongListTeamListItems:function(team_list_members,no_dividers){var members=team_list_members.members;var disabled_members=team_list_members.disabled_members;var deleted_bots=team_list_members.deleted_bots;var bots=team_list_members.bots;var restricted_members=team_list_members.restricted_members;var ultra_restricted_members=team_list_members.ultra_restricted_members;var active_members_list_items=members.slice(0);if(bots.length){if(!no_dividers)active_members_list_items.push({bot:true,is_divider:true});active_members_list_items.push.apply(active_members_list_items,bots)}var restricted_members_list_items=[];if(restricted_members.length){if(!no_dividers)restricted_members_list_items.push({multi_channel_guest:true,is_divider:true});restricted_members_list_items.push.apply(restricted_members_list_items,restricted_members)}if(ultra_restricted_members.length){if(!no_dividers)restricted_members_list_items.push({single_channel_guest:true,restricted_members:!!restricted_members.length,is_divider:true});restricted_members_list_items.push.apply(restricted_members_list_items,ultra_restricted_members)}var deleted_members_list_items=disabled_members.slice(0);if(deleted_bots.length){if(!no_dividers)deleted_members_list_items.push({deleted_bot:true,is_divider:true});deleted_members_list_items.push.apply(deleted_members_list_items,deleted_bots)}return{active_members_list_items:active_members_list_items,restricted_members_list_items:restricted_members_list_items,deleted_members_list_items:deleted_members_list_items}}});var _$active_members_list;var _$restricted_members_list;var _$deleted_members_list})();
